<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Health Panel</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #1a1a1a; color: white; padding: 20px; margin: 0; }
        h1 { text-align: center; margin-bottom: 30px; color: #f0f0f0; letter-spacing: 1px; }
        
        .container { max-width: 1200px; margin: 0 auto; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border-left: 6px solid #555;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: transform 0.2s ease, box-shadow 0.2s;
            position: relative;
        }
        
        /* Interactive Cards */
        .card.interactive { cursor: pointer; }
        .card.interactive:hover { transform: translateY(-2px); background: #333; }
        .card.interactive:active { transform: translateY(0); }

        .card.pass { border-left-color: #4CAF50; background: #253326; }
        .card.fail { border-left-color: #F44336; background: #332525; }
        .card.wait { border-left-color: #FFC107; background: #333125; }
        .card.unknown { border-left-color: #9E9E9E; background: #2d2d2d; }

        h3 { margin: 0 0 10px 0; font-size: 1.1em; color: #ccc; display: flex; justify-content: space-between; align-items: center; }
        .badge { font-size: 0.7em; padding: 2px 6px; border-radius: 4px; background: rgba(255,255,255,0.1); font-weight: normal; }
        .refresh-icon { font-size: 0.8em; opacity: 0; transition: opacity 0.2s; }
        .card:hover .refresh-icon { opacity: 0.5; }

        .status { font-weight: bold; font-size: 1.4em; margin-bottom: 10px; }
        .details { font-size: 0.85em; color: #aaa; white-space: pre-wrap; line-height: 1.4; flex-grow: 1; }
        
        .actions { margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; display: flex; gap: 10px; }
        /* Prevent clicks on actions from triggering card click */
        .actions { cursor: default; }

        button {
            flex: 1; padding: 10px; cursor: pointer;
            background: #444; border: none; color: white; border-radius: 4px;
            font-weight: bold; transition: background 0.2s; font-size: 0.9em;
        }
        button:hover:not(:disabled) { background: #666; }
        button:disabled { background: #333; color: #555; cursor: not-allowed; }
        
        .btn-blue { background: #1565C0; }
        .btn-blue:hover:not(:disabled) { background: #1976D2; }
        .btn-red { background: #C62828; }
        .btn-red:hover:not(:disabled) { background: #D32F2F; }

        select { 
            padding: 10px; width: 100%; margin-bottom: 0;
            background: #111; color: white; border: 1px solid #444; border-radius: 4px;
        }

        #log-container {
            margin-top: 20px;
            background: #111;
            border: 1px solid #444;
            border-radius: 8px;
            overflow: hidden;
        }
        #log-header { padding: 10px 20px; background: #222; font-weight: bold; border-bottom: 1px solid #444; display: flex; justify-content: space-between; align-items: center; }
        #log {
            padding: 20px; font-family: 'Courier New', Courier, monospace; 
            height: 200px; overflow-y: scroll; font-size: 0.85em; color: #0f0;
        }
        .nav-link { text-align: center; margin-top: 20px; }
        .nav-link a { color: #888; text-decoration: none; font-size: 0.9em; }
        .nav-link a:hover { color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ AppServer Diagnostics</h1>

        <div class="grid">
            <div class="card interactive" id="card-health" onclick="checkHealth()">
                <h3>1. Compute Health <span class="refresh-icon">‚Üª</span></h3>
                <div class="status">Waiting...</div>
                <div class="details">Checking /healthcheck endpoint...</div>
            </div>

            <div class="card unknown" id="card-azure">
                <h3>2. Azure Status <span class="badge">Inferred</span></h3>
                <div class="status">Unknown</div>
                <div class="details">Cannot verify VM power state directly via current API.</div>
                <div class="actions" onclick="event.stopPropagation()">
                    <button id="btn-wake" class="btn-blue">Wake Up</button>
                    <button id="btn-stop" class="btn-red">Shut Down</button>
                </div>
            </div>

            <div class="card interactive" id="card-files" onclick="checkFiles()">
                <h3>3. Definitions <span class="refresh-icon">‚Üª</span></h3>
                <div class="status">Waiting...</div>
                <div class="details">Scanning available files...</div>
                <div class="actions" onclick="event.stopPropagation()">
                    <select id="file-select" disabled><option>Loading...</option></select>
                </div>
            </div>

            <div class="card interactive" id="card-interface" onclick="testInterface()">
                <h3>4. Load Interface <span class="refresh-icon">‚Üª</span></h3>
                <div class="status">Waiting...</div>
                <div class="details">Requires healthy Compute Server.</div>
                <div class="actions" onclick="event.stopPropagation()">
                    <button id="btn-load-interface" disabled>Load Selected</button>
                </div>
            </div>

            <div class="card" id="card-validation">
                <h3>5. IO Validation <span class="badge">Schema</span></h3>
                <div class="status">Waiting...</div>
                <div class="details">Depends on Interface Load.</div>
            </div>

            <div class="card interactive" id="card-hops" onclick="testSolve()">
                <h3>6. Hops Simulation <span class="refresh-icon">‚Üª</span></h3>
                <div class="status">Waiting...</div>
                <div class="details">Test full solve cycle with hops_solve.json</div>
                <div class="actions" onclick="event.stopPropagation()">
                    <button id="btn-run-hops" disabled>Run Simulation</button>
                </div>
            </div>

            <div class="card interactive" id="card-appstate" onclick="checkAppLogic()">
                <h3>7. App Logic <span class="refresh-icon">‚Üª</span></h3>
                <div class="status">Waiting...</div>
                <div class="details">Internal state check.</div>
            </div>

            <div class="card interactive" id="card-auth" onclick="checkAuth()">
                <h3>8. Auth Check <span class="refresh-icon">‚Üª</span></h3>
                <div class="status">Waiting...</div>
                <div class="details">Verifying API key...</div>
            </div>

            <div class="card" id="card-ping">
                <h3>9. Network Latency <span class="badge">Info</span></h3>
                <div class="status">Waiting...</div>
                <div class="details" style="font-family: monospace; font-size: 0.9em; line-height: 1.6;">
                    <div>1. Client ‚Üî App:  - ms</div>
                    <div>2. App ‚Üî Compute: - ms</div>
                    <div>3. End-to-End:    - ms</div>
                </div>
            </div>

            <div class="card interactive" id="card-version" onclick="checkVersion()">
                <h3>10. Version <span class="refresh-icon">‚Üª</span></h3>
                <div class="status">Waiting...</div>
                <div class="details">Fetching...</div>
            </div>
        </div>

        <div id="log-container">
            <div id="log-header">
                <span>System Log</span>
                <button onclick="document.getElementById('log').innerText = ''" style="width:auto; padding:5px 10px; font-size:0.7em;">Clear</button>
            </div>
            <div id="log">Initializing...</div>
        </div>

        <div class="nav-link">
            <a href="/">‚Üê Back to Home</a>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>